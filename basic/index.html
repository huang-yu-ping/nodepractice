<html>
  <head>
    <meta charset="UTF-8" />
    <title>XHR</title>
  </head>
  <body>
    <button id="syncBtn">同步</button>
    <button id="asyncBtn">非同步</button>
    <button id="countBtn">計數器</button>
    <div id="count">0</div>
    <div id="message">XXXXX</div>
  </body>
  <script>
    var message = document.getElementById("message");
    var syncBtn = document.getElementById("syncBtn");
    var asyncBtn = document.getElementById("asyncBtn");
    var countBtn = document.getElementById("countBtn");
    var count = document.getElementById("count");

    countBtn.addEventListener("click", function () {
      count.innerText = parseInt(count.innerText, 10) + 1;
    });

    //sync
    syncBtn.addEventListener('click', function() {
        let xhr = new XHRHttpRequest();
        xhr.open('GET', 'http://34.217.120.25:3000', false);
        xhr.send();
        xhr.onload = function() {
            if(xhr.status == 200) {
                console.log('sync success');
            }
        }
        xhr.onprogress = function(e) {
          console.log(`Received ${e.loaded} of ${e.total} bytes`);
        }
        xhr.onerror = function() {
            console.log("request failed");
        };

    })
    
    //async
    /*asyncBtn.addEventListener('click', function() {
        let xhr = new XHRHttpRequest();
        xhr.open('GET', 'http://34.217.120.25:3000');
        xhr.send();
        xhr.onload = function() {
            if(xhr.status == 200) {
                console.log('async success');
            }
        }
         
    })*/

    //promise
    function xhrPromise(url) {
      return new Promise((resolve, reject) => {
        //
        let xhr = new XHRHttpRequest();
        xhr.open('GET', url);
        xhr.onload = function () {
          if (this.status == 200) {
            resolve(this.responseText);
          } else {
            reject(this.status);
          }
        };
        xhr.onerror = function () {
            reject(this.status);
          };
        xhr.send();
      })
    }


    asyncBtn.addEventListener('click', function() {
      xhrPromise('http://34.217.120.25:3000').then(
        result => console.log(result), 
        error => console.log(error)
      )
    });


    

  </script>
</html>